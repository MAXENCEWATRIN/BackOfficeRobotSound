<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Titre de la page</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <!-- development version, includes helpful console warnings -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<body>

  <div class="container">
    <h1>Robot Sound</h1>

    <div id="musician">
      <pre>
        {{error}}
      </pre>
      {{ musician }}
      <form method="post" @submit.prevent="editMusician">
        <input type="hidden" v-model="musician.idMusician">
        <div class="form-group">
          <label for="name-musicien">Nom du musicien *</label>
          <input v-model="musician.name" type="text" class="form-control" id="name-musicien" required placeholder="Insérer le nom du musicien ici">
        </div>
        <div class="form-group">
          <label for="image-musician">Image du Musicien</label>
          <input type="file" class="form-control-file" id="image-musician">
        </div>
        <div class="form-check">
          <input v-model="musician.laser" class="form-check-input" :checked="musician.laser" type="checkbox" name="laser-musicien" id="laser-musicien">
          <label class="form-check-label" for="laser-musicien">Laser</label>
        </div>
        <br>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>



      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">Image</th>
            <th scope="col">Laser</th>
            <th colspan="3">Gestion</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="musician in musicians">
            <th scope="row">  {{ musician.idMusician }}</th>
            <td>  {{ musician.name }}</td>
            <td>  {{ musician.image }}</td>
            <td>  {{ musician.laser }}</td>
            <td colspan="3">
              <button type="button" class="btn btn-primary">Préference</button>
              <button type="button" class="btn btn-danger" v-on:click="deleteMusician(musician.idMusician)">Delete</button>
              <button type="button" class="btn btn-warning" v-on:click="updateMusician(musician)">Update</button>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>


  <script type="text/javascript">

  var URL = "http://localhost:8080/BackOfficeRobotSound/rest";
  var URL_MUSICIAN = URL + "/musicians/";

  var musician = new Vue({
    el: '#musician',
    data: {
      musicians: '',
      error: '',
      message: '',
      musician: {}
    },
    mounted () {
      this.getMusicians()
    },
    methods: {
      updateMusician(musician) {
        this.musician = musician
      },
      editMusician() {
        if(this.musician.idMusician){
          axios.post(URL_MUSICIAN,this.musician)
          .then(response => (
            this.response = response
          )
          .then(
            this.getMusicians()
          )
        ).then(this.musician = {})
        .catch(error => (
          this.error = error
        ));
      }else {
        axios.post(URL_MUSICIAN,this.musician)
        .then(response => (
          this.response = response
        )
        .then(
          this.getMusicians()
        )
      ).then(this.musician = {})
      .catch(error => (
        this.error = error
      ));
    }
  },
  deleteMusician(idMusician) {
    axios.delete(URL_MUSICIAN + idMusician)
    .then(response => (
      this.response = response
    )
    .then(
      this.getMusicians())
    )
    .catch(error => (
      this.error = error
    ));
  },
  getMusicians() {
    axios.get(URL_MUSICIAN)
    .then(response =>
      (this.musicians = response.data)
    )
    .catch(error =>
      (this.error = "Some issues with the server !")
    )
  }
}

});








</script>


</body>
</html>
